// Title:           Duo Security Telephony Parser
// Author:          Microsoft
// Version:         1.0
// Last Updated:    02/11/2021
// Comment:         Initial Release
//  
// DESCRIPTION:
// This parser takes Duo Security Telephony records ingested from the Function App Data Connector and parses the data into a normalized schema
//
// USAGE:
// 1. Open Log Analytics/Azure Sentinel Logs blade. Copy the query below and paste into the Logs query window. 
// 2. Click the Save button above the query. A pane will appear on the right, select "as Function" from the drop down. Enter a Function Name.
//    It is recommended to name the Function Alias, as DuoSecurityTelephony
// 3. Kusto Functions usually take 10-15 minutes to activate. You can then use Function Alias for other queries
//
// REFERENCES: 
// Using functions in Azure monitor log queries: https://docs.microsoft.com/azure/azure-monitor/log-query/functions
//
// 
DuoSecurityTelephony_CL 
| project SourceSystem, TimeGenerated, Type, TenantId, MG, ManagementGroupName, Computer, RawData, _ResourceId,
    Context = column_ifexists("context_s", ""),
    Credits = column_ifexists("credits_d", ""),
    ISOTimeStamp = column_ifexists("isotimestamp_t", ""),
    Phone = column_ifexists("phone_s", ""),
    TimeStamp = column_ifexists("timestamp_d", ""),
    EventType = column_ifexists("type_s", "")