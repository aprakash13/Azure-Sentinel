{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Infoblox CDC BloxOne Threat Defense Workbook\r\n\r\n##### Get a closer look at your BloxOne Threat Defense security event data. \r\n\r\nThis workbook is intended to help visualize BloxOne Threat Defense data as part of the Infoblox Cloud Data Connector. Drilldown your data and visualize events, trends, and anomalous changes over time.\r\n\r\n---\r\n"
      },
      "name": "text - 3",
      "styleSettings": {
        "margin": "0 0 20px 0"
      }
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "46b4abc5-316b-4c75-89b7-5cf134d6dbb0",
            "cellValue": "view",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "81661594-3591-4fe6-a67d-b69ae55abf67",
            "cellValue": "view",
            "linkTarget": "parameter",
            "linkLabel": "Events by IP",
            "subTarget": "Events by IP",
            "preText": "IPs",
            "style": "link"
          },
          {
            "id": "46ca603b-ead0-46bd-987d-1d157b2a763a",
            "cellValue": "view",
            "linkTarget": "parameter",
            "linkLabel": "Events by Domain",
            "subTarget": "Events by Domain",
            "style": "link"
          },
          {
            "id": "2e942b67-07c4-4579-ac5b-f43c5b01c51c",
            "cellValue": "view",
            "linkTarget": "parameter",
            "linkLabel": "Category Filters",
            "subTarget": "Category Filters",
            "style": "link"
          }
        ]
      },
      "name": "links - 16",
      "styleSettings": {
        "margin": "0 0 20px 0"
      }
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "9878ee10-a66a-4438-afdd-29789d76bd61",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 3600000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "30",
      "name": "parameters - 0"
    },
    {
      "type": 1,
      "content": {
        "json": "#### Set a time range for which to view data using the dropdown to the left. It will be applied to all visualizations of this workbook. Note that using a large range may cause queries to timeout depending on the size of your environment. If you have difficulties try reducing the range.\r\n\r\n---\r\n",
        "style": "info"
      },
      "customWidth": "70",
      "name": "text - 7"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Events by IP\r\n---\r\n#### Get a closer look into where threat data is originating. \r\nThis section visualizes which IP addresses are producing the most hits. Further drilldown data by source IP address. \r\n\r\nUse the dropdowns below to filter by Threat Level, Feed, and Class."
            },
            "name": "text - 8"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "12793c1f-b77e-4319-99f6-b6b4230d9cfe",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThreatLevelParam",
                  "label": "Threat Level",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    { \"value\":\"N/A\"},\r\n    { \"value\":\"Info\"},\r\n    { \"value\":\"Low\"},\r\n    { \"value\":\"Medium\"},\r\n    { \"value\":\"High\"}\r\n]",
                  "timeContext": {
                    "durationMs": 259200000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all"
                },
                {
                  "id": "06740a9f-b69a-4769-b747-01898d6b9480",
                  "version": "KqlParameterItem/1.0",
                  "name": "FeedParam",
                  "label": "Feed",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions)   \r\n| where isnotempty(Feed)\r\n| summarize by Feed\r\n| order by Feed asc",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "a4bec1da-10e1-4ae3-846b-d8787f569e39",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThreatClassParam",
                  "label": "Threat Class",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend ThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n| summarize by ThreatClass\r\n| order by ThreatClass asc\r\n| project value = ThreatClass, label = case(ThreatClass == \"\", \"N/A\", ThreatClass)",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 6 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where isnotempty(SourceIP)\r\n| summarize count() by SourceIP\r\n| top 15 by count_ \r\n| project SourceIP);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog \r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where SourceIP in ((Top))\r\n| project TimeGenerated, SourceIP\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceIP\r\n",
              "size": 2,
              "title": "Top Offending IPs by Time",
              "color": "red",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "barchart",
              "sortBy": [],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "createOtherGroup": 15,
                "showLegend": true
              }
            },
            "name": "Top Offending IPs by Time"
          },
          {
            "type": 1,
            "content": {
              "json": "#### Click on a Source IP in the chart below to further drilldown the IP.\r\n\r\n---",
              "style": "info"
            },
            "name": "text - 17"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by SourceIP\r\n| sort by count_ desc",
              "size": 2,
              "title": "Total Source IP Hit Count",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "SourceIP",
              "exportParameterName": "ip",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SourceIP",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "60%"
                    }
                  },
                  {
                    "columnMatch": "count_",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "40%"
                    }
                  },
                  {
                    "columnMatch": "DestinationDnsDomain",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "60%"
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "SourceIP",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "count_",
                    "label": "Total Hits"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "SourceIP",
                  "sortOrder": 1
                }
              ],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "30",
            "name": "Total Source IP Hit Count",
            "styleSettings": {
              "margin": "0 10px 0 0"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| where '{ip}' == SourceIP \r\n\r\n| parse AdditionalExtensions with * \";InfobloxThreatProperty=\" ThreatProperty \";InfobloxThreatConfidence=\" ThreatConfidence \";InfobloxThreatLevel=\" ThreatLevel_Score\r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n| extend ThreatProperty = extract(\"([^_]*$)\", 1, ThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(ThreatLevel_Score)\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| sort by TimeGenerated desc\r\n| project TimeGenerated, SourceIP, DestinationDnsDomain, ThreatLevel, ThreatLevel_Score, ThreatConfidence, Feed, ThreatClass, ThreatProperty,   DeviceAction, Message, SourcePort\r\n",
              "size": 2,
              "title": "Events for {ip}",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ThreatLevel",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "N/A",
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Info",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ThreatLevel_Score",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "is Empty",
                          "representation": "gray",
                          "text": "N/A"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "80",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "50",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "1",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "[\"ThreatLevel\"]",
                        "columnSettings": [
                          {
                            "columnName": "ThreatLevel",
                            "color": "orange"
                          },
                          {
                            "columnName": "DestinationDnsDomain",
                            "color": "blue"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "ThreatConfidence",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "purpleBlueGreen",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "LogSeverity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "green",
                          "text": "N/A"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "1",
                          "representation": "blue",
                          "text": "Low/Info"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "5",
                          "representation": "orange",
                          "text": "Medium"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "8",
                          "representation": "red",
                          "text": "High"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "LogSeverity",
                            "color": "blue"
                          },
                          {
                            "columnName": "DestinationDnsDomain",
                            "color": "purple"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "TimeGenerated"
                  },
                  {
                    "columnId": "SourceIP"
                  },
                  {
                    "columnId": "DestinationDnsDomain"
                  },
                  {
                    "columnId": "Message"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "ip",
              "comparison": "isNotEqualTo"
            },
            "showPin": false,
            "name": "Events for {ip}"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where '{ip}' == SourceIP \r\n| summarize count() by Feed\r\n| top 10 by count_ \r\n| project Feed);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where Feed in ((Top))\r\n| where '{ip}' == SourceIP \r\n| project TimeGenerated, Feed\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Feed",
              "size": 3,
              "title": "Feed Trend for {ip}",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart"
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "ip",
              "comparison": "isNotEqualTo"
            },
            "name": "Feed Trend for {ip}",
            "styleSettings": {
              "margin": "0px 10px 0px 0px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend ThreatClass = case(ThreatClass == \"\", \"N/A\", ThreatClass)\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where '{ip}' == SourceIP \r\n| summarize count() by ThreatClass\r\n| top 10 by count_ \r\n| project ThreatClass);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| extend ThreatClass = case(ThreatClass == \"\", \"N/A\", ThreatClass)\r\n| where ThreatClass in ((Top))\r\n| where '{ip}' == SourceIP \r\n| project TimeGenerated, ThreatClass\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ThreatClass",
              "size": 3,
              "title": "Threat Class Trend for {ip}",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart"
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "ip",
              "comparison": "isNotEqualTo"
            },
            "name": "Threat Class Trend for {ip}",
            "styleSettings": {
              "margin": "0px 10px 0px 0px"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| where '{ip}' == SourceIP \r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ThreatLevel",
              "size": 2,
              "title": "Threat Level Trend for {ip}",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart",
              "chartSettings": {
                "group": "ThreatLevel",
                "createOtherGroup": null,
                "seriesLabelSettings": [
                  {
                    "seriesName": "N/A",
                    "label": "N/A",
                    "color": "turquoise"
                  },
                  {
                    "seriesName": "Info",
                    "label": "",
                    "color": "lightBlue"
                  },
                  {
                    "seriesName": "Low",
                    "label": "",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "Medium",
                    "label": "",
                    "color": "orange"
                  },
                  {
                    "seriesName": "High",
                    "color": "red"
                  }
                ]
              }
            },
            "customWidth": "33",
            "conditionalVisibility": {
              "parameterName": "ip",
              "comparison": "isNotEqualTo"
            },
            "name": "Threat Level Trend for {ip}"
          },
          {
            "type": 1,
            "content": {
              "json": "#### The time graph below utilizes Time Brushing. Click and drag between two points of the graph to view events for only that window of time. By not selecting any window you can also view all events for the TimeRange selected at the top of this workbook. \r\n\r\n---",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "ip",
              "comparison": "isNotEqualTo"
            },
            "name": "text - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\nlet timeframe = 1h;\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where '{ip}' == SourceIP \r\n| where isnotempty(DestinationDnsDomain)\r\n| summarize count() by DestinationDnsDomain\r\n| top 15 by count_ \r\n| project DestinationDnsDomain);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel = extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions) \r\n| extend ThreatLevel = toint(ThreatLevel)\r\n| extend ThreatLevel = case(ThreatLevel>=80, \"High\",\r\n                       ThreatLevel>=50 and ThreatLevel<80, \"Medium\",\r\n                       ThreatLevel<50 and ThreatLevel>=1, \"Low\",\r\n                       ThreatLevel == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where '{ip}' == SourceIP \r\n| where DestinationDnsDomain in ((Top))\r\n| project TimeGenerated, DestinationDnsDomain\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DestinationDnsDomain\r\n",
              "size": 2,
              "title": "Top Domains for {ip} by Time",
              "color": "red",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "brush",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart",
              "sortBy": [],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "createOtherGroup": 15,
                "showLegend": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "ip",
              "comparison": "isNotEqualTo"
            },
            "name": "Top Domains for {ip} by Time"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Total Events for {ip} between {brush:label}",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and TimeGenerated {brush} and DeviceEventClassID has_cs \"RPZ\"\r\n| where '{ip}' == SourceIP \r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count()",
                    "size": 3,
                    "title": "Events Count",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "Events Count"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and TimeGenerated {brush} and DeviceEventClassID has_cs \"RPZ\"\r\n| where '{ip}' == SourceIP \r\n\r\n| parse AdditionalExtensions with * \";InfobloxThreatProperty=\" ThreatProperty \";InfobloxThreatConfidence=\" ThreatConfidence \";InfobloxThreatLevel=\" ThreatLevel_Score\r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n| extend ThreatProperty = extract(\"([^_]*$)\", 1, ThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(ThreatLevel_Score)\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| sort by TimeGenerated desc\r\n| project TimeGenerated, SourceIP, DestinationDnsDomain, ThreatLevel, ThreatLevel_Score, ThreatConfidence, Feed, ThreatClass, ThreatProperty, DeviceAction, Message, SourcePort\r\n",
                    "size": 2,
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ThreatLevel",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "N/A",
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Info",
                                "representation": "lightBlue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ThreatLevel_Score",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "gray",
                                "text": "N/A"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "80",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "50",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "1",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "lightBlue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "[\"ThreatLevel\"]",
                              "columnSettings": [
                                {
                                  "columnName": "ThreatLevel",
                                  "color": "orange"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "blue"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "ThreatConfidence",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "purpleBlueGreen",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        },
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "green",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "blue",
                                "text": "Low/Info"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "5",
                                "representation": "orange",
                                "text": "Medium"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "8",
                                "representation": "red",
                                "text": "High"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "Message"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "showPin": false,
                  "name": "Events for {ip} between {brush:label} - grid"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ip",
              "comparison": "isNotEqualTo"
            },
            "name": "Total Events for {ip} between {brush:label}"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "view",
        "comparison": "isEqualTo",
        "value": "Events by IP"
      },
      "name": "Events by IP"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Events by Destination Domain\r\n---\r\n#### Get a closer look into what is being queried. \r\nThis section visualizes what domains are producing the most hits. Further drilldown data by destination domain. \r\n\r\nUse the dropdowns below to filter by Threat Level, Feed, and Class."
            },
            "name": "text - 6"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "7a14c478-6a17-4750-a9a5-91d65b776a1b",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThreatLevelParam",
                  "label": "Threat Level",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    { \"value\":\"N/A\"},\r\n    { \"value\":\"Info\"},\r\n    { \"value\":\"Low\"},\r\n    { \"value\":\"Medium\"},\r\n    { \"value\":\"High\"}\r\n]",
                  "timeContext": {
                    "durationMs": 259200000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all"
                },
                {
                  "id": "9c7f9be1-3480-47c2-b586-d4e2da6bb65c",
                  "version": "KqlParameterItem/1.0",
                  "name": "FeedParam",
                  "label": "Feed",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions)   \r\n| where isnotempty(Feed)\r\n| summarize by Feed\r\n| order by Feed asc",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "092a2314-4295-4902-9f0e-1482545ebe92",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThreatClassParam",
                  "label": "Threat Class",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "let newstr = '';\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend ThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n//| where isnotempty(ThreatClass)\r\n| summarize by ThreatClass\r\n| order by ThreatClass asc\r\n| project value = case(ThreatClass == \"\", newstr, ThreatClass), label = case(ThreatClass == \"\", \"N/A\", ThreatClass) //, selected = iff(ThreatClass == \"\", true, false)",
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 6 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\nlet timeframe = 1h;\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where isnotempty(DestinationDnsDomain)\r\n| summarize count() by DestinationDnsDomain\r\n| top 15 by count_ \r\n| project DestinationDnsDomain);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where DestinationDnsDomain in ((Top))\r\n| project TimeGenerated, DestinationDnsDomain\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DestinationDnsDomain\r\n",
              "size": 2,
              "title": "Top Offending Domains by Time",
              "color": "red",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "barchart",
              "sortBy": [],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "createOtherGroup": 15,
                "showLegend": true
              }
            },
            "name": "Top Offending Domains by Time"
          },
          {
            "type": 1,
            "content": {
              "json": "#### Click on a Domain in the chart below to further drilldown the domain.\r\n\r\n---",
              "style": "info"
            },
            "name": "text - 14"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by DestinationDnsDomain\r\n| sort by count_ desc",
              "size": 2,
              "title": "Total Offending Domain Hit Count",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "DestinationDnsDomain",
              "exportParameterName": "domain",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DestinationDnsDomain",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "60%"
                    }
                  },
                  {
                    "columnMatch": "count_",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "40%"
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "DestinationDnsDomain"
                  },
                  {
                    "columnId": "count_",
                    "label": "Total Hits"
                  }
                ]
              },
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "30",
            "name": "Total Offending Domain Hit Count",
            "styleSettings": {
              "margin": "0 10px 0 0"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| where '{domain}' == DestinationDnsDomain \r\n\r\n| parse AdditionalExtensions with * \";InfobloxThreatProperty=\" ThreatProperty \";InfobloxThreatConfidence=\" ThreatConfidence \";InfobloxThreatLevel=\" ThreatLevel_Score\r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n| extend ThreatProperty = extract(\"([^_]*$)\", 1, ThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(ThreatLevel_Score)\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| sort by TimeGenerated desc\r\n| project TimeGenerated, DestinationDnsDomain, SourceIP, ThreatLevel, ThreatLevel_Score, ThreatConfidence, Feed, ThreatClass, ThreatProperty, DeviceAction, Message, SourcePort\r\n",
              "size": 2,
              "title": "Events for {domain}",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ThreatLevel",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "N/A",
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Info",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ThreatLevel_Score",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "is Empty",
                          "representation": "gray",
                          "text": "N/A"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "80",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "50",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "1",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": ""
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "[\"ThreatLevel\"]",
                        "columnSettings": [
                          {
                            "columnName": "ThreatLevel",
                            "color": "orange"
                          },
                          {
                            "columnName": "DestinationDnsDomain",
                            "color": "blue"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "ThreatConfidence",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "purpleBlueGreen",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "LogSeverity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "green",
                          "text": "N/A"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "1",
                          "representation": "blue",
                          "text": "Low/Info"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "5",
                          "representation": "orange",
                          "text": "Medium"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "8",
                          "representation": "red",
                          "text": "High"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "LogSeverity",
                            "color": "blue"
                          },
                          {
                            "columnName": "DestinationDnsDomain",
                            "color": "purple"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "TimeGenerated"
                  },
                  {
                    "columnId": "DestinationDnsDomain"
                  },
                  {
                    "columnId": "SourceIP"
                  },
                  {
                    "columnId": "ThreatLevel"
                  },
                  {
                    "columnId": "ThreatLevel_Score",
                    "label": ""
                  },
                  {
                    "columnId": "ThreatConfidence"
                  },
                  {
                    "columnId": "Feed"
                  },
                  {
                    "columnId": "ThreatClass"
                  },
                  {
                    "columnId": "ThreatProperty"
                  },
                  {
                    "columnId": "DeviceAction"
                  },
                  {
                    "columnId": "Message"
                  },
                  {
                    "columnId": "SourcePort"
                  }
                ]
              },
              "sortBy": []
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "domain",
              "comparison": "isNotEqualTo"
            },
            "showPin": false,
            "name": "Events for {domain}"
          },
          {
            "type": 1,
            "content": {
              "json": "#### The time graph below utilizes Time Brushing. Click and drag between two points of the graph to view events for only that window of time. By not selecting any window you can also view all events for the TimeRange selected at the top of this workbook. \r\n\r\n---",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "domain",
              "comparison": "isNotEqualTo"
            },
            "name": "text - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\nlet timeframe = 1h;\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where '{domain}' == DestinationDnsDomain\r\n| where isnotempty(SourceIP)\r\n| summarize count() by SourceIP\r\n| top 15 by count_ \r\n| project SourceIP);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where '{domain}' == DestinationDnsDomain\r\n| where SourceIP in ((Top))\r\n| project TimeGenerated, SourceIP\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceIP\r\n",
              "size": 2,
              "title": "Top IPs Querying {domain} by Time",
              "timeContext": {
                "durationMs": 2592000000
              },
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "brush",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart",
              "sortBy": [],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "showLegend": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "domain",
              "comparison": "isNotEqualTo"
            },
            "name": "Top IPs Querying {domain} by Time"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Events for {domain} between {brush:label}",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and TimeGenerated {brush} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel = extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions) \r\n| extend ThreatLevel = toint(ThreatLevel)\r\n| extend ThreatLevel = case(ThreatLevel>=80, \"High\",\r\n                       ThreatLevel>=50 and ThreatLevel<80, \"Medium\",\r\n                       ThreatLevel<50 and ThreatLevel>=1, \"Low\",\r\n                       ThreatLevel == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where '{domain}' == DestinationDnsDomain \r\n| summarize count()",
                    "size": 3,
                    "title": "Events Count",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "Events Count"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and TimeGenerated {brush} and DeviceEventClassID has_cs \"RPZ\"\r\n| where '{domain}' == DestinationDnsDomain \r\n\r\n| parse AdditionalExtensions with * \";InfobloxThreatProperty=\" ThreatProperty \";InfobloxThreatConfidence=\" ThreatConfidence \";InfobloxThreatLevel=\" ThreatLevel_Score\r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n| extend ThreatProperty = extract(\"([^_]*$)\", 1, ThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(ThreatLevel_Score)\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| sort by TimeGenerated desc\r\n| project TimeGenerated, DestinationDnsDomain, SourceIP, ThreatLevel, ThreatLevel_Score, ThreatConfidence, Feed, ThreatClass, ThreatProperty, DeviceAction, Message, SourcePort\r\n",
                    "size": 2,
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ThreatLevel",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "N/A",
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Info",
                                "representation": "lightBlue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "ThreatLevel_Score",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "gray",
                                "text": "N/A"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "80",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "50",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "1",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "lightBlue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": ""
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "[\"ThreatLevel\"]",
                              "columnSettings": [
                                {
                                  "columnName": "ThreatLevel",
                                  "color": "orange"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "blue"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "ThreatConfidence",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 100,
                            "palette": "purpleBlueGreen",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        },
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "green",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "blue",
                                "text": "Low/Info"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "5",
                                "representation": "orange",
                                "text": "Medium"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "8",
                                "representation": "red",
                                "text": "High"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "ThreatLevel"
                        },
                        {
                          "columnId": "ThreatLevel_Score",
                          "label": ""
                        },
                        {
                          "columnId": "ThreatConfidence"
                        },
                        {
                          "columnId": "Feed"
                        },
                        {
                          "columnId": "ThreatClass"
                        },
                        {
                          "columnId": "ThreatProperty"
                        },
                        {
                          "columnId": "DeviceAction"
                        },
                        {
                          "columnId": "Message"
                        },
                        {
                          "columnId": "SourcePort"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "showPin": false,
                  "name": "Domain RPZ Events - grid"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "domain",
              "comparison": "isNotEqualTo"
            },
            "name": "Events for {domain} between {brush:label}"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "view",
        "comparison": "isEqualTo",
        "value": "Events by Domain"
      },
      "name": "Events by Domain"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Overview\r\n---\r\n#### Top level insight into the overall health of your data.\r\n\r\nUse the dropdowns below to filter by Threat Level, Feed and Class.\r\n\r\n"
            },
            "name": "text - 8"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "5b2e1804-a9a6-4b86-8a6e-27fd0ab029b5",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThreatLevelParam",
                  "label": "Threat Level",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "value": [
                    "value::all"
                  ],
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    { \"value\":\"N/A\"},\r\n    { \"value\":\"Info\"},\r\n    { \"value\":\"Low\"},\r\n    { \"value\":\"Medium\"},\r\n    { \"value\":\"High\"}\r\n]",
                  "timeContext": {
                    "durationMs": 259200000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all"
                },
                {
                  "id": "1bc7a1f9-d3bd-4e0f-b5ae-4dc8ba8a1463",
                  "version": "KqlParameterItem/1.0",
                  "name": "FeedParam",
                  "label": "Feed",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions)   \r\n| where isnotempty(Feed)\r\n| summarize by Feed\r\n| order by Feed asc",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 0
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "value": [
                    "value::all"
                  ]
                },
                {
                  "id": "1eedd218-57c0-43e3-a306-a716380b05e6",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThreatClassParam",
                  "label": "Threat Class",
                  "type": 2,
                  "isRequired": true,
                  "multiSelect": true,
                  "quote": "\"",
                  "delimiter": ",",
                  "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend ThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n| summarize by ThreatClass\r\n| order by ThreatClass asc\r\n| project value = ThreatClass, label = case(ThreatClass == \"\", \"N/A\", ThreatClass)",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::all"
                    ],
                    "selectAllValue": "All",
                    "showDefault": false
                  },
                  "timeContext": {
                    "durationMs": 604800000
                  },
                  "timeContextFromParameter": "TimeRange",
                  "defaultValue": "value::all",
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces",
                  "value": [
                    "value::all"
                  ]
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 6 - Copy - Copy"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count()",
                    "size": 3,
                    "title": "Total Hits",
                    "timeContext": {
                      "durationMs": 259200000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "gridSettings": {
                      "rowLimit": 200,
                      "sortBy": [
                        {
                          "itemKey": "InfobloxThreatLevel",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "InfobloxThreatLevel",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "33",
                  "name": "Total Hits"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count()",
                    "size": 3,
                    "title": "Total Category Filter Hits",
                    "color": "orange",
                    "timeContext": {
                      "durationMs": 259200000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "yellowGreenBlue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "33",
                  "name": "Total Category Filter Hits"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions !contains \"InfobloxRPZ=CAT_\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count()",
                    "size": 3,
                    "title": "Total Non-Category Filter Hits",
                    "color": "orange",
                    "timeContext": {
                      "durationMs": 259200000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "coldHot"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "33",
                  "name": "Total Non-Category Filter Hits"
                }
              ]
            },
            "name": "Totals"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| make-series Hits = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}",
              "size": 0,
              "title": "Hits over Time",
              "color": "orange",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "areachart"
            },
            "name": "Hits over Time"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by DestinationDnsDomain\r\n| top 50 by count_ desc",
              "size": 3,
              "title": "Top Offending Domains",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "tiles",
              "gridSettings": {
                "filter": true
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  }
                },
                "showBorder": false
              },
              "chartSettings": {
                "createOtherGroup": 0
              }
            },
            "name": "Top Offending Domains"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by SourceIP\r\n| top 20 by count_ desc",
              "size": 0,
              "title": "Top Offending IPs",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "barchart",
              "chartSettings": {
                "createOtherGroup": 0
              }
            },
            "name": "Top Offending IPs"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n## Threat Level"
            },
            "name": "text - 8"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "datatable (Count:long, ThreatLevel:string, ThreatLevel_count:long) [0,\"N/A\",1, 0,\"Info\",2, 0,\"Low\",3, 0,\"Medium\",4, 0,\"High\",5]\r\n|union\r\n(\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| extend ThreatLevel_count = case(ThreatLevel == \"High\", 5, ThreatLevel==\"Medium\", 4, ThreatLevel==\"Low\", 3, ThreatLevel==\"Info\", 2, 1)\r\n| summarize Count = count() by ThreatLevel, ThreatLevel_count\r\n)\r\n| summarize Count=sum(Count) by ThreatLevel, ThreatLevel_count\r\n| sort by ThreatLevel_count asc",
              "size": 2,
              "title": "Total Hit Count by Threat Level",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "graph",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "ThreatLevel",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "colors",
                    "thresholdsGrid": [
                      {
                        "operator": "==",
                        "thresholdValue": "High",
                        "representation": "red",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Medium",
                        "representation": "orange",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Low",
                        "representation": "yellow",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "Info",
                        "representation": "lightBlue",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "==",
                        "thresholdValue": "N/A",
                        "representation": "gray",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "thresholdValue": null,
                        "representation": "blue",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "leftContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "yellowOrangeRed"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "showBorder": false,
                "sortCriteriaField": "status_count",
                "sortOrderField": 1,
                "size": "auto"
              },
              "graphSettings": {
                "type": 2,
                "topContent": {
                  "columnMatch": "ThreatLevel",
                  "formatter": 1
                },
                "centerContent": {
                  "columnMatch": "Count",
                  "formatter": 1,
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "style": "decimal",
                      "useGrouping": false,
                      "maximumFractionDigits": 2,
                      "maximumSignificantDigits": 3
                    }
                  }
                },
                "nodeIdField": "Count",
                "graphOrientation": 3,
                "showOrientationToggles": false,
                "nodeSize": null,
                "staticNodeSize": 100,
                "colorSettings": {
                  "nodeColorField": "ThreatLevel",
                  "type": 3,
                  "thresholdsGrid": [
                    {
                      "operator": "==",
                      "thresholdValue": "N/A",
                      "representation": "gray"
                    },
                    {
                      "operator": "==",
                      "thresholdValue": "Info",
                      "representation": "lightBlue"
                    },
                    {
                      "operator": "==",
                      "thresholdValue": "Low",
                      "representation": "yellow"
                    },
                    {
                      "operator": "==",
                      "thresholdValue": "Medium",
                      "representation": "orange"
                    },
                    {
                      "operator": "==",
                      "thresholdValue": "High",
                      "representation": "red"
                    },
                    {
                      "operator": "Default",
                      "thresholdValue": null,
                      "representation": "gray"
                    }
                  ]
                },
                "hivesMargin": 5
              }
            },
            "customWidth": "30",
            "name": "Total Hit Count by Threat Level"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ThreatLevel",
              "size": 2,
              "title": "Threat Level Trend",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart",
              "chartSettings": {
                "showLegend": true,
                "seriesLabelSettings": [
                  {
                    "seriesName": "High",
                    "color": "red"
                  },
                  {
                    "seriesName": "N/A",
                    "color": "gray"
                  },
                  {
                    "seriesName": "Low",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "Medium",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Info",
                    "color": "lightBlue"
                  }
                ]
              }
            },
            "customWidth": "70",
            "name": "Threat Level Trend"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n## Feed"
            },
            "name": "text - 8 - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by Feed\r\n| order by Feed desc",
              "size": 2,
              "title": "Total Hit Count by Feed",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Feed",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "50%"
                    }
                  },
                  {
                    "columnMatch": "count_",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "50%"
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Feed",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Feed"
                  },
                  {
                    "columnId": "count_",
                    "label": "Total Hits"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Feed",
                  "sortOrder": 1
                }
              ],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "30",
            "name": "Total Hit Count by Feed",
            "styleSettings": {
              "margin": "0 10px 0 0"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by Feed\r\n| top 10 by count_ \r\n| project Feed);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog \r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| where Feed in ((Top))\r\n| project TimeGenerated, Feed\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Feed",
              "size": 2,
              "title": "Feed Trend",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart",
              "chartSettings": {
                "showLegend": true,
                "seriesLabelSettings": [
                  {
                    "seriesName": "0",
                    "label": "N/A",
                    "color": "green"
                  },
                  {
                    "seriesName": "1",
                    "label": "Low/Info",
                    "color": "blue"
                  },
                  {
                    "seriesName": "8",
                    "label": "High",
                    "color": "red"
                  },
                  {
                    "seriesName": "5",
                    "label": "Medium",
                    "color": "orange"
                  }
                ]
              }
            },
            "customWidth": "70",
            "name": "Feed Trend",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n## Class"
            },
            "name": "text - 8 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| extend ThreatClass = case(ThreatClass == \"\", \"N/A\", ThreatClass)\r\n| summarize count() by ThreatClass\r\n| order by ThreatClass asc\r\n\r\n\r\n",
              "size": 2,
              "title": "Total Hit Count by Class",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "count_",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      },
                      "customColumnWidthSetting": "50%"
                    }
                  },
                  {
                    "columnMatch": "Feed",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "50%"
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "ThreatClass"
                  },
                  {
                    "columnId": "count_",
                    "label": "Total Hits"
                  }
                ]
              },
              "sortBy": [],
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "DestinationDnsDomain",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "count_",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              }
            },
            "customWidth": "30",
            "name": "Total Hit Count by Class",
            "styleSettings": {
              "margin": "0 10px 0 0"
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend ThreatClass = case(ThreatClass == \"\", \"N/A\", ThreatClass)\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by ThreatClass\r\n| top 10 by count_ \r\n| project ThreatClass);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog \r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange}\r\n| where DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| extend ThreatClass = case(ThreatClass == \"\", \"N/A\", ThreatClass)\r\n| where ThreatClass in ((Top))\r\n| project TimeGenerated, ThreatClass\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by ThreatClass",
              "size": 2,
              "title": "Class Trend",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart",
              "chartSettings": {
                "showLegend": true
              }
            },
            "customWidth": "70",
            "name": "Class Trend",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n## Action"
            },
            "name": "text - 8 - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| summarize count() by DeviceAction\r\n| top 10 by count_ desc",
              "size": 2,
              "title": "Total Hit Count By Action",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart",
              "chartSettings": {
                "createOtherGroup": 10
              }
            },
            "customWidth": "30",
            "name": "Total Hit Count By Action"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| extend InfobloxThreatProperty = extract(\"InfobloxThreatProperty=(.*?);\", 1, AdditionalExtensions) \r\n| extend ThreatClass = extract(\"(.*?)_\", 1, InfobloxThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(extract(\"InfobloxThreatLevel=(.*)\", 1, AdditionalExtensions))\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DeviceAction",
              "size": 2,
              "title": "Action Trend",
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart",
              "chartSettings": {
                "showLegend": true,
                "seriesLabelSettings": [
                  {
                    "seriesName": "0",
                    "label": "N/A",
                    "color": "green"
                  },
                  {
                    "seriesName": "1",
                    "label": "Low/Info",
                    "color": "blue"
                  },
                  {
                    "seriesName": "8",
                    "label": "High",
                    "color": "red"
                  },
                  {
                    "seriesName": "5",
                    "label": "Medium",
                    "color": "orange"
                  }
                ]
              }
            },
            "customWidth": "70",
            "name": "Action Trend",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n## Events"
            },
            "name": "text - 8 - Copy - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\"\r\n| parse AdditionalExtensions with * \";InfobloxThreatProperty=\" ThreatProperty \";InfobloxThreatConfidence=\" ThreatConfidence \";InfobloxThreatLevel=\" ThreatLevel_Score\r\n| extend ThreatClass = extract(\"(.*?)_\", 1, ThreatProperty) \r\n| extend ThreatProperty = extract(\"([^_]*$)\", 1, ThreatProperty) \r\n| where ThreatClass in ({ThreatClassParam}) or '{ThreatClassParam:label}' ==  \"All\"\r\n| extend Feed = extract(\"InfobloxRPZ=(.*?);\", 1, AdditionalExtensions) \r\n| where Feed in ({FeedParam}) or '{FeedParam:label}' ==  \"All\"\r\n| extend ThreatLevel_Score = toint(ThreatLevel_Score)\r\n| extend ThreatLevel = case(ThreatLevel_Score>=80, \"High\",\r\n                       ThreatLevel_Score>=50 and ThreatLevel_Score<80, \"Medium\",\r\n                       ThreatLevel_Score<50 and ThreatLevel_Score>=1, \"Low\",\r\n                       ThreatLevel_Score == 0,\"Info\",\r\n                       \"N/A\" )\r\n| where ThreatLevel in ({ThreatLevelParam}) or '{ThreatLevelParam:label}' ==  \"All\"\r\n| sort by TimeGenerated desc\r\n| project TimeGenerated, DestinationDnsDomain, SourceIP, ThreatLevel, ThreatLevel_Score, ThreatConfidence, Feed, ThreatClass, ThreatProperty, DeviceAction, Message, SourcePort\r\n",
              "size": 2,
              "timeContext": {
                "durationMs": 259200000
              },
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "ThreatLevel",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "N/A",
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Info",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ThreatLevel_Score",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "is Empty",
                          "representation": "gray",
                          "text": "N/A"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "80",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "50",
                          "representation": "orange",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "1",
                          "representation": "yellow",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "lightBlue",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": ""
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "[\"ThreatLevel\"]",
                        "columnSettings": [
                          {
                            "columnName": "ThreatLevel",
                            "color": "orange"
                          },
                          {
                            "columnName": "DestinationDnsDomain",
                            "color": "blue"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "ThreatConfidence",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "purpleBlueGreen",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    }
                  },
                  {
                    "columnMatch": "LogSeverity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "green",
                          "text": "N/A"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "1",
                          "representation": "blue",
                          "text": "Low/Info"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "5",
                          "representation": "orange",
                          "text": "Medium"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "8",
                          "representation": "red",
                          "text": "High"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "LogSeverity",
                            "color": "blue"
                          },
                          {
                            "columnName": "DestinationDnsDomain",
                            "color": "purple"
                          }
                        ]
                      }
                    }
                  },
                  {
                    "columnMatch": "Count",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_heatmap_ThreatConfidence_5",
                    "sortOrder": 2
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "TimeGenerated"
                  },
                  {
                    "columnId": "DestinationDnsDomain"
                  },
                  {
                    "columnId": "SourceIP"
                  },
                  {
                    "columnId": "ThreatLevel"
                  },
                  {
                    "columnId": "ThreatLevel_Score",
                    "label": ""
                  },
                  {
                    "columnId": "ThreatConfidence"
                  },
                  {
                    "columnId": "Feed"
                  },
                  {
                    "columnId": "ThreatClass"
                  },
                  {
                    "columnId": "ThreatProperty"
                  },
                  {
                    "columnId": "DeviceAction"
                  },
                  {
                    "columnId": "Message"
                  },
                  {
                    "columnId": "SourcePort"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_heatmap_ThreatConfidence_5",
                  "sortOrder": 2
                }
              ]
            },
            "showPin": false,
            "name": "RPZ Events"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "view",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "Overview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Category Filters \r\n---\r\n\r\nCategory filters are content categorization rules that BloxOne Threat Defense Cloud uses to detect and filter specific internet content. Based on your configuration, specific actions such as Allow or Block will be taken on the detected content. BloxOne Threat Defense Cloud provides the following content categories from which you can build your category filters: \r\n\r\n* Drugs\r\n* Risk/Fraud/Crime \r\n* Entertainment/Culture\r\n* Purchasing \r\n* Information/Communication \r\n* Business/Services\r\n* Information Technology \r\n* Lifestyle\r\n* Society/Education/Religion\r\n* Mature/Violent\r\n* Games/Gambling\r\n* Pornography/Nudity\r\n* Uncategorized\r\n\r\nEach of these categories contains sub-categories that further define the respective content. For example, the Drugs category includes the following sub-categories: Tobacco, Alcohol, and Drugs. When you configure your category filter, you can add as many categories and sub-categories as you need. For example, if you want BloxOne Threat Defense Cloud to detect and block internet content related to tobacco and alcohol, you select and add these sub-categories while configuring your category filter. You then add the category filter to your security policy and assign the Block action for the filter."
            },
            "name": "text - 2",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| summarize count()",
                    "size": 3,
                    "title": "Total Category Filter Hits",
                    "color": "orange",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "yellowGreenBlue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "name": "Total Category Filter Hits"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Top Category Filter Hits",
                    "items": [
                      {
                        "type": 9,
                        "content": {
                          "version": "KqlParameterItem/1.0",
                          "parameters": [
                            {
                              "id": "be7263d9-229e-4875-a60a-76114659b718",
                              "version": "KqlParameterItem/1.0",
                              "name": "CatFilterSorter",
                              "label": "Sort Tiles By",
                              "type": 2,
                              "isRequired": true,
                              "typeSettings": {
                                "additionalResourceOptions": [],
                                "showDefault": false
                              },
                              "jsonData": "[\r\n    { \"value\":\"count_ desc\", \"label\":\"Hit Count\", \"selected\":true },\r\n    { \"value\":\"DestinationDnsDomain asc, count_ desc\", \"label\":\"Domain Name\" },\r\n    { \"value\":\"CategoryFilter asc, count_ desc\", \"label\":\"Filter Type\" }\r\n]",
                              "timeContext": {
                                "durationMs": 86400000
                              }
                            }
                          ],
                          "style": "pills",
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces"
                        },
                        "name": "Top Category Filters RPZ Hits",
                        "styleSettings": {
                          "margin": "0px 0px 0px 10px"
                        }
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions) \r\n| summarize count() by DestinationDnsDomain, CategoryFilter\r\n| sort by {CatFilterSorter}\r\n| take 50\r\n",
                          "size": 3,
                          "timeContext": {
                            "durationMs": 2592000000
                          },
                          "timeContextFromParameter": "TimeRange",
                          "showExportToExcel": true,
                          "queryType": 0,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "visualization": "tiles",
                          "gridSettings": {
                            "filter": true
                          },
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "DestinationDnsDomain",
                              "formatter": 1
                            },
                            "subtitleContent": {
                              "columnMatch": "CategoryFilter",
                              "formatter": 1
                            },
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "bladeOpenContext": {
                                  "bladeParameters": []
                                }
                              }
                            },
                            "showBorder": false,
                            "rowLimit": 50,
                            "sortOrderField": 1
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "DestinationDnsDomain",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "count_",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "Tops",
                        "styleSettings": {
                          "margin": "-20px 0px 0px 0px"
                        }
                      }
                    ]
                  },
                  "name": "Top Category Filter Hits",
                  "styleSettings": {
                    "margin": "10px"
                  }
                }
              ]
            },
            "name": "Overview",
            "styleSettings": {
              "margin": "0px"
            }
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n## By Type"
            },
            "name": "text - 4"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| summarize count() by CategoryFilter\r\n| top 15 by count_ \r\n| project CategoryFilter);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where CategoryFilter in ((Top))\r\n| project TimeGenerated, CategoryFilter\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by CategoryFilter",
                    "size": 2,
                    "title": "Top Offending Category Filter Types by Time",
                    "color": "red",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "chartSettings": {
                      "createOtherGroup": 15,
                      "showLegend": true
                    }
                  },
                  "name": "Top Offending Category Filter Types by Time"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Click on a Category Filter in the chart below to further drilldown the Filter.\r\n---",
                    "style": "info"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions) \r\n| summarize count() by CategoryFilter\r\n| sort by count_ desc",
                    "size": 2,
                    "title": "Total Category Filter Hit Count",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "CategoryFilter",
                    "exportParameterName": "filter",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "CategoryFilter",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "60%"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            },
                            "customColumnWidthSetting": "40%"
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Total Hits"
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "DestinationDnsDomain",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "30",
                  "name": "Total Category Filter Hit Count",
                  "styleSettings": {
                    "margin": "0 10px 0 0"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n | where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where '{filter}' == CategoryFilter\r\n| sort by  TimeGenerated desc, SourceIP desc\r\n| project TimeGenerated, CategoryFilter, SourceIP, DestinationDnsDomain, LogSeverity, DeviceAction, Message, SourcePort\r\n",
                    "size": 2,
                    "title": "Events for {filter}",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "N/A"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Message",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40%"
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "DestinationDnsDomain",
                          "sortOrder": 1
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "CategoryFilter"
                        },
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "LogSeverity",
                          "label": "ThreatLevel"
                        },
                        {
                          "columnId": "DeviceAction"
                        },
                        {
                          "columnId": "Message"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "DestinationDnsDomain",
                        "sortOrder": 1
                      }
                    ]
                  },
                  "customWidth": "70",
                  "conditionalVisibility": {
                    "parameterName": "filter",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "Events for {filter}"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where '{filter}' == CategoryFilter \r\n| summarize count() by SourceIP\r\n| top 10 by count_ desc\r\n",
                    "size": 2,
                    "title": "Top IPs for {filter}",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "green",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "blue",
                                "text": "Low/Info"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "5",
                                "representation": "orange",
                                "text": "Medium"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "8",
                                "representation": "red",
                                "text": "High"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "LogSeverity",
                          "label": "Threat Level"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "Activity"
                        },
                        {
                          "columnId": "Message"
                        },
                        {
                          "columnId": "ApplicationProtocol"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "filter",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "Top IPs for {filter}"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where '{filter}' == CategoryFilter \r\n| summarize count() by DestinationDnsDomain\r\n| top 10 by count_ \r\n| project DestinationDnsDomain);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions) \r\n| where '{filter}' == CategoryFilter \r\n| where DestinationDnsDomain in ((Top))\r\n| project TimeGenerated, DestinationDnsDomain\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by DestinationDnsDomain\r\n",
                    "size": 2,
                    "title": "Top Domains for {filter} by Time",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "green",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "blue",
                                "text": "Low/Info"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "5",
                                "representation": "orange",
                                "text": "Medium"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "8",
                                "representation": "red",
                                "text": "High"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "LogSeverity",
                          "label": "Threat Level"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "Activity"
                        },
                        {
                          "columnId": "Message"
                        },
                        {
                          "columnId": "ApplicationProtocol"
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "createOtherGroup": 0,
                      "showLegend": true
                    }
                  },
                  "customWidth": "74",
                  "conditionalVisibility": {
                    "parameterName": "filter",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "Top Domains for {filter} by Time",
                  "styleSettings": {
                    "margin": "0 0 0 1%"
                  }
                }
              ]
            },
            "name": "Category Filter By Type"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n## By Source IP"
            },
            "name": "text - 5"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| summarize count() by SourceIP\r\n| top 15 by count_ \r\n| project SourceIP);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| where SourceIP in ((Top))\r\n| project TimeGenerated, SourceIP\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SourceIP",
                    "size": 2,
                    "title": "Top Offending IPs by Time",
                    "color": "red",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "barchart",
                    "chartSettings": {
                      "createOtherGroup": 0,
                      "showLegend": true
                    }
                  },
                  "name": "Top Offending IPs by Time"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Click on a Source IP in the chart below to further drilldown the IP.\r\n\r\n---",
                    "style": "info"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| summarize count() by SourceIP\r\n| sort by count_ desc",
                    "size": 2,
                    "title": "Total Offending IP Hit Count",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "SourceIP",
                    "exportParameterName": "ip_cat",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SourceIP",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "60%"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 3,
                          "formatOptions": {
                            "palette": "greenRed",
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            },
                            "customColumnWidthSetting": "40%"
                          }
                        },
                        {
                          "columnMatch": "CategoryFilter",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "50%"
                          }
                        }
                      ],
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "count_",
                          "label": "Total Hits"
                        }
                      ]
                    },
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "DestinationDnsDomain",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "customWidth": "30",
                  "name": "Total Offending IP Hit Count",
                  "styleSettings": {
                    "margin": "0 10px 0 0"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where '{ip_cat}' == SourceIP\r\n| sort by TimeGenerated desc, CategoryFilter desc\r\n| project TimeGenerated, SourceIP, CategoryFilter, DestinationDnsDomain, LogSeverity, DeviceAction, Message, SourcePort\r\n",
                    "size": 2,
                    "title": "Events for {ip_cat}",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "N/A"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Message",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40%"
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "CategoryFilter"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "LogSeverity",
                          "label": "ThreatLevel"
                        },
                        {
                          "columnId": "DeviceAction"
                        },
                        {
                          "columnId": "Message"
                        },
                        {
                          "columnId": "SourcePort"
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "70",
                  "conditionalVisibility": {
                    "parameterName": "ip_cat",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "Events for {ip_cat}"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where '{ip_cat}' == SourceIP \r\n| summarize count() by DestinationDnsDomain",
                    "size": 2,
                    "title": "Top Category Filter Domains for {ip_cat}",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "piechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "green",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "blue",
                                "text": "Low/Info"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "5",
                                "representation": "orange",
                                "text": "Medium"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "8",
                                "representation": "red",
                                "text": "High"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "LogSeverity",
                          "label": "Threat Level"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "Activity"
                        },
                        {
                          "columnId": "Message"
                        },
                        {
                          "columnId": "ApplicationProtocol"
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "createOtherGroup": 10
                    }
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "ip_cat",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "Top Category Filter Domains for {ip_cat}"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let starttime = {TimeRange:start};\r\nlet endtime = {TimeRange:end};\r\n// Finding Tops \r\nlet Top = materialize(CommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\" \r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where '{ip_cat}' == SourceIP \r\n| summarize count() by CategoryFilter\r\n| top 10 by count_ \r\n| project CategoryFilter);\r\n// Filtering datasource to Tops and Plot Time chart\r\nCommonSecurityLog\r\n| where DeviceVendor == \"Infoblox\" and DeviceProduct == \"Data Connector\"\r\n| where TimeGenerated {TimeRange} and DeviceEventClassID has_cs \"RPZ\" and AdditionalExtensions contains \"InfobloxRPZ=CAT_\"\r\n| extend CategoryFilter = extract(\"InfobloxDomainCat=(.*?);\", 1, AdditionalExtensions)\r\n| where '{ip_cat}' == SourceIP \r\n| where CategoryFilter in ((Top))\r\n| project TimeGenerated, CategoryFilter\r\n| make-series Total= count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by CategoryFilter",
                    "size": 2,
                    "title": "Top Filters for {ip_cat} by Time",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "linechart",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "LogSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "0",
                                "representation": "green",
                                "text": "N/A"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "1",
                                "representation": "blue",
                                "text": "Low/Info"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "5",
                                "representation": "orange",
                                "text": "Medium"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "8",
                                "representation": "red",
                                "text": "High"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": [
                                {
                                  "columnName": "LogSeverity",
                                  "color": "blue"
                                },
                                {
                                  "columnName": "DestinationDnsDomain",
                                  "color": "purple"
                                }
                              ]
                            }
                          }
                        },
                        {
                          "columnMatch": "Count",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "SourceIP"
                        },
                        {
                          "columnId": "TimeGenerated"
                        },
                        {
                          "columnId": "LogSeverity",
                          "label": "Threat Level"
                        },
                        {
                          "columnId": "DestinationDnsDomain"
                        },
                        {
                          "columnId": "Activity"
                        },
                        {
                          "columnId": "Message"
                        },
                        {
                          "columnId": "ApplicationProtocol"
                        }
                      ]
                    },
                    "sortBy": [],
                    "chartSettings": {
                      "createOtherGroup": 0,
                      "showLegend": true
                    }
                  },
                  "customWidth": "75",
                  "conditionalVisibility": {
                    "parameterName": "ip_cat",
                    "comparison": "isNotEqualTo"
                  },
                  "showPin": false,
                  "name": "Top Filters for {ip_cat} by Time"
                }
              ]
            },
            "name": "Category Filter by IP"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "view",
        "comparison": "isEqualTo",
        "value": "Category Filters"
      },
      "name": "Category Filters"
    }
  ],
  "styleSettings": {
    "spacingStyle": "none"
  },
  "fromTemplateId": "sentinel-InfobloxCDCB1TDWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
