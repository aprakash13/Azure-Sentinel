id: xxxxxxxxxxxxxxxxxx
name: ProofpointPOD - Recipients with large number of corrupted emails
description: |
  'Search for recipients with large number of corrupted emails.'
requiredDataConnectors:
  - connectorId: ProofpointPOD
    dataTypes:
      - ProofpointPOD_message_CL
tactics:
  - InitialAccess
query: |
let lbtime = 24h;
ProofpointPOD
| where TimeGenerated > ago(lbtime)
| where EventType == 'message'
| where NetworkDirection == 'inbound'
| extend isCorrupted = todynamic(MsgParts)[0]['isCorrupted']
| where isCorrupted == 'true'
| summarize count() by DstUserUpn
| sort by count_
| where count_ > 10
