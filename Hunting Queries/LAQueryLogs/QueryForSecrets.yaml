id: 2bf19f27-0466-4c16-a821-ce84e524476d
name: Queries looking for secrets
description: |
  'This hunting query looks for queries that appear to be looking for secrets or passwords in tables.'
requiredDataConnectors:
  - connectorId: CustomConnector
    dataTypes:
      - LAQueryLogs
tactics:
  - Collection
relevantTechniques:
  - T1530
  - T1213
query: |

  let keywords = dynamic(["password", "pwd", "creds", "credentials", "secret"]);
  let timeframe = 7d;
  LAQueryLogs
  | where TimeGenerated > ago(timeframe)
  | extend querytext_lower = tolower(QueryText)
  | where querytext_lower has_any(keywords)
  | project TimeGenerated, AADEmail, QueryText, RequestClientApp, RequestTarget, ResponseCode, ResponseRowCount, ResponseDurationMs
  | extend timestamp = TimeGenerated, AccountCustomEntity = AADEmail

