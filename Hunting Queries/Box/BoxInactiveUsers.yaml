id: c0a4169e-c713-484b-95a9-d8f437b52d66
name: Box - Inactive users
description: |
  'Query shows inactive user accounts (users which last login time is more than 30 days).'
severity: Medium
requiredDataConnectors:
  - connectorId: BoxDataConnector
    dataTypes:
      - BoxEvents_CL
tactics:
  - InitialAccess
query: |
  let active_users = BoxEvents
  | where TimeGenerated between (ago(30d) .. ago(1d))
  | where EventType('LOGIN')
  | summarize makeset(SourceLogin);
  BoxEvents
  | where TimeGenerated > ago(30d)
  | where EventType('LOGIN')
  | where SourceLogin !in (active_users)
  | summarize LastLoginTime = max(TimeGenerated) by SourceLogin
  | project LastLoginTime, SourceLogin
  | extend AccountCustomEntity = SourceLogin
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: AccountCustomEntity
