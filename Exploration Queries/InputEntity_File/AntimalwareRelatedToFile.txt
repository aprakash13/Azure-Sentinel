// Name: Antimalware related to File
// Description: Any Antimwalware hits related to a given File during the range of +6h and -6h
//
// Id: 78dd53ab-65a8-4a0e-97dc-bec754156a60
//
// Entity: #File
// Input: Filename
// Output: Host, Account
//
// QueryPeriod: +6h and -6h default, change as needed
//
// DataSource: ProtectionStatus
//
// Tactics: #Persistence, #Discovery, #Lateral Movement, #Collection
//
let GetAMWithFile = (suspiciousEventTime:datetime, v_File:string){
let v_StartTime = suspiciousEventTime-1d;
let v_EndTime = suspiciousEventTime+1d;
ProtectionStatus
| where TimeGenerated between (v_StartTime .. v_EndTime)
| where AntiMalware_FileName_CF contains v_File
};
// change datetime value and <filename> value below
GetAMWithFile(datetime('2019-01-18T10:36:07Z'), "<filename>")