id: 1fa1528e-f746-4794-8a41-14827f4cb798
name: Potential Password Spray Attempts
description: |
  'This query identifies evidence of potential password spray activity against the Pulse Secure VPN server, 
   by looking for failures from multiple accounts, originating from the same host within a time window'
severity: Medium
requiredDataConnectors:
  - connectorId: PulseConnectSecure
    dataTypes: 
      - Syslog
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - CredentialAccess
  relevantTechniques:
  - T1110  
query: |

  let timeframe = ago(1h);
  let threshold = 100;
  PulseConnectSecure
  | where TimeGenerated >= timeframe
  | where Messages startswith "Login failed"
  | summarize dcount(User) by Computer, bin(TimeGenerated, 15m)
  | where dcount_User > threshold
  | extend timestamp = TimeGenerated, HostCustomEntity = Computer